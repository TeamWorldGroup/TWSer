{"version":3,"sources":["lib/plugins/daycycle.js"],"names":["module","exports","server","serv","setTime","time","_writeAll","age","doDaylightCycle","on","delta","count","behavior","old","newTime","player","commands","add","base","info","usage","op","action","handleCommand","parse","str","data","match","value","parseInt","chat"],"mappings":";;AAAAA,OAAOC,OAAP,CAAeC,MAAf,GAAsB,UAASC,IAAT,EAAe;AACnCA,OAAKC,OAAL,GAAe,UAACC,IAAD,EAAU;AACvBF,SAAKE,IAAL,GAAYA,IAAZ;AACAF,SAAKG,SAAL,CAAe,aAAf,EAA8B;AAC5BC,WAAK,CAAC,CAAD,EAAI,CAAJ,CADuB,EACf;AACbF,YAAM,CAAC,CAAD,EAAIF,KAAKE,IAAT;AAFsB,KAA9B;AAID,GAND;;AAQAF,OAAKK,eAAL,GAAuB,IAAvB;;AAEAL,OAAKE,IAAL,GAAY,CAAZ;;AAEAF,OAAKM,EAAL,CAAQ,MAAR,EAAgB,UAACC,KAAD,EAAOC,KAAP,EAAiB;AAC/B,QAAI,CAACR,KAAKK,eAAV,EAA2B;AAC3B,QAAIG,QAAQ,EAAR,IAAc,CAAlB,EAAqB;AACnBR,WAAKS,QAAL,CAAc,YAAd,EAA4B;AAC1BC,aAAKV,KAAKE,IADgB;AAE1BS,iBAASX,KAAKE,IAAL,GAAY;AAFK,OAA5B,EAGG,gBAAe;AAAA,YAAbS,OAAa,QAAbA,OAAa;;AAChBX,aAAKC,OAAL,CAAaU,UAAU,KAAvB,EADgB,CACe;AAChC,OALD;AAMD;AACF,GAVD;AAWD,CAxBD;;AA0BAd,OAAOC,OAAP,CAAec,MAAf,GAAsB,UAASA,MAAT,EAAgBZ,IAAhB,EAAqB;AACzCY,SAAOC,QAAP,CAAgBC,GAAhB,CAAoB;AAClBC,UAAM,OADY;AAElBC,UAAM,2BAFY;AAGlBC,WAAO,QAHW;AAIlBC,QAAI,IAJc;AAKlBC,UALkB,oBAKT;AACP,aAAOP,OAAOQ,aAAP,CAAqB,gBAArB,CAAP;AACD;AAPiB,GAApB;;AAUAR,SAAOC,QAAP,CAAgBC,GAAhB,CAAoB;AAClBC,UAAM,MADY;AAElBC,UAAM,kBAFY;AAGlBC,WAAO,+BAHW;AAIlBC,QAAI,IAJc;AAKlBG,SALkB,iBAKZC,GALY,EAKP;AACT,UAAMC,OAAOD,IAAIE,KAAJ,CAAU,0CAAV,CAAb;AACA,UAAG,CAACD,IAAJ,EAAU,OAAO,KAAP;AACV,aAAO;AACLJ,gBAAQI,KAAK,CAAL,CADH;AAELE,eAAOF,KAAK,CAAL,KAAW,KAAX,GAAmB,IAAnB,GAA2BA,KAAK,CAAL,KAAW,OAAX,GAAqB,KAArB,GAA6BG,SAASH,KAAK,CAAL,CAAT;AAF1D,OAAP;AAID,KAZiB;AAalBJ,UAbkB,yBAaK;AAAA,UAAfA,OAAe,SAAfA,MAAe;AAAA,UAARM,KAAQ,SAARA,KAAQ;;AACrB,UAAGN,WAAU,OAAb,EAAsB;AACpBP,eAAOe,IAAP,CAAY,WAAS3B,KAAKE,IAA1B;AACD,OAFD,MAEO;AACL,YAAIS,gBAAJ;;AAEA,YAAGQ,WAAU,KAAb,EAAoB;AAClBR,oBAAUc,KAAV;AACD,SAFD,MAEO,IAAGN,WAAU,KAAb,EAAoB;AACzBR,oBAAUc,QAAQzB,KAAKE,IAAvB;AACD;;AAEDU,eAAOe,IAAP,CAAY,2BAA2B3B,KAAKE,IAAhC,GAAuC,MAAvC,GAAgDS,OAA5D;AACAX,aAAKC,OAAL,CAAaU,OAAb;AACD;AACF;AA5BiB,GAApB;;AA+BAC,SAAOC,QAAP,CAAgBC,GAAhB,CAAoB;AAClBC,UAAM,KADY;AAElBC,UAAM,yBAFY;AAGlBC,WAAO,MAHW;AAIlBC,QAAI,IAJc;AAKlBC,UALkB,oBAKT;AACP,aAAOP,OAAOQ,aAAP,CAAqB,cAArB,CAAP;AACD;AAPiB,GAApB;AASD,CAnDD","file":"../../../lib/plugins/daycycle.js","sourcesContent":["module.exports.server=function(serv) {\n  serv.setTime = (time) => {\n    serv.time = time;\n    serv._writeAll('update_time', {\n      age: [0, 0], // TODO\n      time: [0, serv.time]\n    });\n  };\n\n  serv.doDaylightCycle = true;\n\n  serv.time = 0;\n\n  serv.on('tick', (delta,count) => {\n    if (!serv.doDaylightCycle) return;\n    if (count % 20 == 0) {\n      serv.behavior('changeTime', {\n        old: serv.time,\n        newTime: serv.time + 20\n      }, ({newTime}) => {\n        serv.setTime(newTime % 24000); // Vanilla only does it every second\n      });\n    }\n  })\n};\n\nmodule.exports.player=function(player,serv){\n  player.commands.add({\n    base: 'night',\n    info: 'to change a time to night',\n    usage: '/night',\n    op: true,\n    action() {\n      return player.handleCommand('time set night');\n    }\n  });\n\n  player.commands.add({\n    base: 'time',\n    info: 'to change a time',\n    usage: '/time <add|query|set> <value>',\n    op: true,\n    parse(str) {\n      const data = str.match(/^(add|query|set)(?: ([0-9]+|day|night))?/);\n      if(!data) return false;\n      return {\n        action: data[1],\n        value: data[2] == 'day' ? 1000 : (data[2] == 'night' ? 13000 : parseInt(data[2]))\n      };\n    },\n    action({action,value}) {\n      if(action == \"query\") {\n        player.chat(\"It is \"+serv.time);\n      } else {\n        let newTime;\n\n        if(action == \"set\") {\n          newTime = value;\n        } else if(action == \"add\") {\n          newTime = value + serv.time;\n        }\n\n        player.chat(\"Time was changed from \" + serv.time + \" to \" + newTime);\n        serv.setTime(newTime);\n      }\n    }\n  });\n\n  player.commands.add({\n    base: 'day',\n    info: 'to change a time to day',\n    usage: '/day',\n    op: true,\n    action() {\n      return player.handleCommand('time set day');\n    }\n  });\n};"]}