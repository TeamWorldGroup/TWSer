{"version":3,"sources":["lib/plugins/placeBlock.js"],"names":["blocks","require","version","Vec3","materialToSound","undefined","module","exports","player","serv","_client","on","direction","heldItem","location","blockId","referencePosition","x","y","z","directionVector","directionToVector","placedPosition","plus","behavior","id","damage","itemDamage","position","reference","playSound","sound","material","world","clone","add","pitch","inventory","slots","heldItemSlot","console","log","changeBlock","setBlock","write","getBlockType","getBlockData","sendBlock"],"mappings":"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","file":"../../../lib/plugins/placeBlock.js","sourcesContent":["const blocks=require(\"minecraft-data\")(require(\"flying-squid\").version).blocks;\nconst Vec3 = require(\"vec3\").Vec3;\n\nconst materialToSound = {\n  undefined: 'stone',\n  'rock': 'stone',\n  'dirt': 'grass',\n  'plant': 'grass',\n  'wool': 'cloth',\n  'web': 'cloth',\n  'wood': 'wood'\n};\n\nmodule.exports.player=function(player,serv)\n{\n  player._client.on(\"block_place\",({direction,heldItem,location} = {}) => {\n    if(direction==-1 || heldItem.blockId==-1 || !blocks[heldItem.blockId]) return;\n    const referencePosition=new Vec3(location.x,location.y,location.z);\n    const directionVector=directionToVector[direction];\n    const placedPosition=referencePosition.plus(directionVector);\n    player.behavior('placeBlock', {\n      direction: directionVector,\n      heldItem: heldItem,\n      id: heldItem.blockId,\n      damage: heldItem.itemDamage,\n      position: placedPosition,\n      reference: referencePosition,\n      playSound: true,\n      sound: 'dig.' + (materialToSound[blocks[heldItem.blockId].material] || 'stone')\n    }, ({direction, heldItem, position, playSound, sound, id, damage}) => {\n      if (playSound) {\n        serv.playSound(sound, player.world, placedPosition.clone().add(new Vec3(0.5, 0.5, 0.5)), {\n          pitch: 0.8\n        });\n      }\n      \n      player.inventory.slots[36+player.heldItemSlot]--;\n      console.log(\"place block id \" + id + \" damage \" + damage);\n      if(heldItem.blockId!=323){\n          player.changeBlock(position, id, damage);\n          if (heldItem.blockId == 175) {\n            player.changeBlock(position.plus(new Vec3(0, 1, 0)), id, 8);\n          }\n      }else if(direction==1){\n        player.setBlock(position, 63, 0);\n          player._client.write('open_sign_entity', {\n              location:position\n          });\n      }else{\n        player.setBlock(position, 68, 0);\n          player._client.write('open_sign_entity', {\n              location:position\n          });\n      }\n    }, async () => {\n      const id = await player.world.getBlockType(placedPosition);\n      const damage = await player.world.getBlockData(placedPosition);\n      player.sendBlock(placedPosition, id, damage);\n    });\n  });\n};\n\nconst directionToVector=[new Vec3(0,-1,0),new Vec3(0,1,0),new Vec3(0,0,-1),new Vec3(0,0,1),new Vec3(-1,0,0),new Vec3(1,0,0)];\n"]}