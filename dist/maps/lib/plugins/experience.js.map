{"version":3,"sources":["lib/plugins/experience.js"],"names":["require","experience","distanceToXpLevel","getXpLevel","getBaseXpFromLevel","module","exports","player","xp","displayXp","xpLevel","sendXp","_client","write","experienceBar","level","totalExperience","setXpLevel","setDisplayXp","Math","max","min","setXp","setLevel","setDisplay","send","commands","add","base","info","usage","op","parse","str","match","action","args","isLevel","amt","parseInt","user","serv","getPlayer","chat","username","currLevel","baseCurrLevel","extraXp"],"mappings":";;0BAAwDA,QAAQ,cAAR,EAAwBC,U;IAAzEC,iB,uBAAAA,iB;IAAkBC,U,uBAAAA,U;IAAWC,kB,uBAAAA,kB;;AAEpCC,OAAOC,OAAP,CAAeC,MAAf,GAAwB,UAASA,MAAT,EAAiB;AACvCA,SAAOC,EAAP,GAAY,CAAZ;AACAD,SAAOE,SAAP,GAAmB,CAAnB;AACAF,SAAOG,OAAP,GAAiB,CAAjB;;AAEAH,SAAOI,MAAP,GAAgB,YAAM;AACpBJ,WAAOK,OAAP,CAAeC,KAAf,CAAqB,YAArB,EAAmC;AACjCC,qBAAeP,OAAOE,SADW;AAEjCM,aAAOR,OAAOQ,KAFmB;AAGjCC,uBAAiBT,OAAOC;AAHS,KAAnC;AAKD,GAND;;AAQAD,SAAOU,UAAP,GAAoB,UAACF,KAAD,EAAW;AAC7BR,WAAOG,OAAP,GAAiBK,KAAjB;AACAR,WAAOI,MAAP;AACD,GAHD;;AAKAJ,SAAOW,YAAP,GAAsB,YAAM;AAC1BX,WAAOE,SAAP,GAAmBU,KAAKC,GAAL,CAAS,CAAT,EAAYD,KAAKE,GAAL,CAAS,CAAT,EAAYd,OAAOE,SAAnB,CAAZ,CAAnB;AACAF,WAAOI,MAAP;AACD,GAHD;;AAKAJ,SAAOe,KAAP,GAAe,UAACd,EAAD,EAA0D;AAAA,mFAAP,EAAO;AAAA,6BAAnDe,QAAmD;AAAA,QAAnDA,QAAmD,iCAA1C,IAA0C;AAAA,+BAApCC,UAAoC;AAAA,QAApCA,UAAoC,mCAAzB,IAAyB;AAAA,yBAAnBC,IAAmB;AAAA,QAAnBA,IAAmB,6BAAd,IAAc;;AACvElB,WAAOC,EAAP,GAAYA,EAAZ;AACA,QAAIe,QAAJ,EAAchB,OAAOQ,KAAP,GAAeZ,WAAWK,EAAX,CAAf;AACd,QAAIgB,UAAJ,EAAgBjB,OAAOE,SAAP,GAAmBP,kBAAkBM,EAAlB,CAAnB;AAChB,QAAIiB,IAAJ,EAAUlB,OAAOI,MAAP;AACX,GALD;;AAOAJ,SAAOmB,QAAP,CAAgBC,GAAhB,CAAoB;AAClBC,UAAM,IADY;AAElBC,UAAM,0BAFY;AAGlBC,WAAO,iDAHW;AAIlBC,QAAI,IAJc;AAKlBC,SALkB,iBAKZC,GALY,EAKP;AACT,aAAOA,IAAIC,KAAJ,CAAU,+BAAV,KAA8C,KAArD;AACD,KAPiB;AAQlBC,UARkB,kBAQXC,IARW,EAQL;AACX,UAAMC,UAAU,CAAC,CAACD,KAAK,CAAL,CAAlB;AACA,UAAME,MAAMC,SAASH,KAAK,CAAL,CAAT,CAAZ;AACA,UAAMI,OAAOJ,KAAK,CAAL,IAAUK,KAAKC,SAAL,CAAeN,KAAK,CAAL,CAAf,CAAV,GAAoC7B,MAAjD;AACA,UAAI,CAACiC,IAAL,EAAW,OAAOJ,KAAK,CAAL,IAAU,yBAAjB;;AAEX,UAAI,CAACC,OAAL,EAAc;AACZG,aAAKlB,KAAL,CAAWkB,KAAKhC,EAAL,GAAU8B,GAArB;AACA/B,eAAOoC,IAAP,CAAY,UAAUH,KAAKI,QAAf,GAA0B,GAA1B,GAAgCN,GAAhC,GAAsC,KAAlD;AACD,OAHD,MAGO;AACL,YAAMO,YAAY1C,WAAWI,OAAOC,EAAlB,CAAlB;AACA,YAAMsC,gBAAgB1C,mBAAmByC,SAAnB,CAAtB;AACA,YAAME,UAAUxC,OAAOC,EAAP,GAAYsC,aAA5B;AACAN,aAAKlB,KAAL,CAAWlB,mBAAmByC,YAAYP,GAA/B,IAAsCS,OAAjD;AACAxC,eAAOoC,IAAP,CAAY,UAAUH,KAAKI,QAAf,GAA0B,GAA1B,GAAgCN,GAAhC,GAAsC,SAAlD;AACD;AACF;AAxBiB,GAApB;AA0BD,CAxDD","file":"../../../lib/plugins/experience.js","sourcesContent":["const {distanceToXpLevel,getXpLevel,getBaseXpFromLevel}=require(\"flying-squid\").experience;\n\nmodule.exports.player = function(player) {\n  player.xp = 0;\n  player.displayXp = 0;\n  player.xpLevel = 0;\n\n  player.sendXp = () => {\n    player._client.write('experience', {\n      experienceBar: player.displayXp,\n      level: player.level,\n      totalExperience: player.xp\n    });\n  };\n\n  player.setXpLevel = (level) => {\n    player.xpLevel = level;\n    player.sendXp();\n  };\n\n  player.setDisplayXp = () => {\n    player.displayXp = Math.max(0, Math.min(1, player.displayXp));\n    player.sendXp();\n  };\n\n  player.setXp = (xp, { setLevel=true, setDisplay=true, send=true }={}) => {\n    player.xp = xp;\n    if (setLevel) player.level = getXpLevel(xp);\n    if (setDisplay) player.displayXp = distanceToXpLevel(xp);\n    if (send) player.sendXp();\n  };\n\n  player.commands.add({\n    base: 'xp',\n    info: 'Give yourself experience',\n    usage: '/xp <amount> [player] OR /xp <amount>L [player]',\n    op: true,\n    parse(str) {\n      return str.match(/(-?\\d+)(L)? ?([a-zA-Z0-9_]+)?/) || false;\n    },\n    action(args) {\n      const isLevel = !!args[2];\n      const amt = parseInt(args[1]);\n      const user = args[3] ? serv.getPlayer(args[3]) : player;\n      if (!user) return args[3] + ' is not on this server!';\n\n      if (!isLevel) {\n        user.setXp(user.xp + amt);\n        player.chat('Gave ' + user.username + ' ' + amt + ' xp');\n      } else {\n        const currLevel = getXpLevel(player.xp);\n        const baseCurrLevel = getBaseXpFromLevel(currLevel);\n        const extraXp = player.xp - baseCurrLevel;\n        user.setXp(getBaseXpFromLevel(currLevel + amt) + extraXp);\n        player.chat('Gave ' + user.username + ' ' + amt + ' levels');\n      }\n    }\n  });\n};"]}