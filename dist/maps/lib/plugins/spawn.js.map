{"version":3,"sources":["lib/plugins/spawn.js"],"names":["version","require","entitiesByName","mobsById","mobs","objectsById","objects","Entity","path","requireIndex","plugins","join","__dirname","Item","UserError","Vec3","module","exports","server","serv","options","initEntity","type","entityType","world","position","entities","length","Error","entityMaxId","entity","filter","pluginName","undefined","forEach","emit","spawnObject","pitch","yaw","velocity","data","itemId","itemDamage","pickupTime","deathTime","object","scaled","floored","name","gravity","terminalvelocity","friction","size","updateAndSpawn","spawnMob","headPitch","metadata","mob","health","destroyEntity","_writeOthersNearby","entityIds","id","player","commands","add","base","info","usage","op","action","chat","Math","random","parse","str","args","split","number","s","floor","sqrt","i","offset","map","entityTypes","reduce","prec","attach","carrier","selectorString","attached","spawnEntity","_client","write","spawnPacketName","getSpawnPacket","sendMetadata","blockId","itemCount","equipment","slot","entityId","item","toNotch","lastPositionPlayersUpdated","clone","nearbyEntities","viewDistance","score","bornTime","Date","now","scaledVelocity","playerUUID","uuid","x","y","z","currentItem","objectData","intField","velocityX","velocityY","velocityZ","updatedEntities","getNearby","entitiesToAdd","indexOf","e","entitiesToRemove","despawnEntities","playersToAdd","playersToRemove","p","on","distanceTo","destroy","attachedEntity","leash","vehicleId"],"mappings":"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","file":"../../../lib/plugins/spawn.js","sourcesContent":["const version = require(\"flying-squid\").version;\nconst entitiesByName=require(\"minecraft-data\")(version).entitiesByName;\nconst mobsById=require(\"minecraft-data\")(version).mobs;\nconst objectsById=require(\"minecraft-data\")(version).objects;\nconst Entity = require(\"prismarine-entity\");\nconst path = require('path');\nconst requireIndex = require('requireindex');\nconst plugins = requireIndex(path.join(__dirname,'..', 'plugins'));\nconst Item = require(\"prismarine-item\")(version);\nconst UserError = require('flying-squid').UserError;\n\nconst Vec3 = require(\"vec3\").Vec3;\n\nmodule.exports.server=function(serv,options) {\n  serv.initEntity = (type, entityType, world, position) => {\n    if(Object.keys(serv.entities).length>options[\"max-entities\"])\n      throw new Error(\"Too many mobs !\");\n    serv.entityMaxId++;\n    const entity = new Entity(serv.entityMaxId);\n\n    Object.keys(plugins)\n      .filter(pluginName => plugins[pluginName].entity!=undefined)\n      .forEach(pluginName => plugins[pluginName].entity(entity, serv, options));\n\n    entity.initEntity(type, entityType, world, position);\n\n    serv.emit(\"newEntity\",entity);\n\n    return entity;\n  };\n\n  serv.spawnObject = (type, world, position, {pitch=0,yaw=0,velocity=new Vec3(0,0,0),data=1,itemId,itemDamage=0,pickupTime=undefined,deathTime=undefined}) => {\n    const object = serv.initEntity('object', type, world, position.scaled(32).floored());\n    object.name=objectsById[type].name;\n    object.data = data;\n    object.velocity = velocity.scaled(32).floored();\n    object.pitch = pitch;\n    object.yaw = yaw;\n    object.gravity = new Vec3(0, -20*32, 0);\n    object.terminalvelocity = new Vec3(27*32, 27*32, 27*32);\n    object.friction = new Vec3(15*32, 0, 15*32);\n    object.size = new Vec3(0.25*32, 0.25*32, 0.25*32); // Hardcoded, will be dependent on type!\n    object.deathTime = deathTime;\n    object.pickupTime = pickupTime;\n    object.itemId = itemId;\n    object.itemDamage = itemDamage;\n\n    object.updateAndSpawn();\n  };\n\n  serv.spawnMob = (type, world, position, {pitch=0,yaw=0,headPitch=0,velocity=new Vec3(0,0,0),metadata=[]}={}) => {\n    const mob = serv.initEntity('mob', type, world, position.scaled(32).floored());\n    mob.name=mobsById[type].name;\n    mob.velocity = velocity.scaled(32).floored();\n    mob.pitch = pitch;\n    mob.headPitch = headPitch;\n    mob.yaw = yaw;\n    mob.gravity = new Vec3(0, -20*32, 0);\n    mob.terminalvelocity = new Vec3(27*32, 27*32, 27*32);\n    mob.friction = new Vec3(15*32, 0, 15*32);\n    mob.size = new Vec3(0.75, 1.75, 0.75);\n    mob.health = 20;\n    mob.metadata = metadata;\n\n    mob.updateAndSpawn();\n    return mob;\n  };\n\n  serv.destroyEntity = entity => {\n    entity._writeOthersNearby('entity_destroy', {\n      entityIds: [entity.id]\n    });\n    delete serv.entities[entity.id];\n  };\n};\n\n\nmodule.exports.player=function(player,serv,options){\n  player.commands.add({\n    base: 'summon',\n    info: 'Summon an entity',\n    usage: '/summon <entity_name>',\n    op: true,\n    action(name) {\n      if(Object.keys(serv.entities).length>options[\"max-entities\"])\n        throw new UserError(\"Too many mobs !\");\n      const entity=entitiesByName[name];\n      if(!entity) {\n        player.chat(\"No entity named \"+name);\n        return;\n      }\n      if(entity.type==\"mob\") serv.spawnMob(entity.id, player.world, player.position.scaled(1/32), {\n        velocity: Vec3((Math.random() - 0.5) * 10, Math.random()*10 + 10, (Math.random() - 0.5) * 10)\n      });\n      else if(entity.type==\"object\") serv.spawnObject(entity.id, player.world, player.position.scaled(1/32), {\n        velocity: Vec3((Math.random() - 0.5) * 10, Math.random()*10 + 10, (Math.random() - 0.5) * 10)\n      });\n    }\n  });\n\n  player.commands.add({\n    base: 'summonMany',\n    info: 'Summon many entities',\n    usage: '/summonMany <number> <entity_name>',\n    op: true,\n    parse(str) {\n      var args=str.split(\" \");\n      if(args.length!=2)\n        return false;\n      return {number:args[0],name:args[1]};\n    },\n    action({number,name}) {\n      if(Object.keys(serv.entities).length>options[\"max-entities\"]-number)\n        throw new UserError(\"Too many mobs !\");\n      const entity=entitiesByName[name];\n      if(!entity) {\n        player.chat(\"No entity named \"+name);\n        return;\n      }\n      let s=Math.floor(Math.sqrt(number));\n      for(let i=0;i<number;i++) {\n        if(entity.type==\"mob\")\n          serv.spawnMob(entity.id, player.world, player.position.scaled(1 / 32).offset(Math.floor(i / s * 10), 0, i % s * 10), {\n          velocity: Vec3((Math.random() - 0.5) * 10, Math.random() * 10 + 10, (Math.random() - 0.5) * 10)\n        });\n        else if(entity.type==\"object\")\n          serv.spawnObject(entity.id, player.world, player.position.scaled(1 / 32).offset(Math.floor(i / s * 10), 0, i % s * 10), {\n          velocity: Vec3((Math.random() - 0.5) * 10, Math.random() * 10 + 10, (Math.random() - 0.5) * 10)\n        });\n      }\n    }\n  });\n\n  player.commands.add({\n    base: 'pile',\n    info: 'make a pile of entities',\n    usage: '/pile <entities types>',\n    op: true,\n    parse(str)  {\n      const args=str.split(' ');\n      if(args.length==0)\n        return false;\n      return args\n        .map(name => entitiesByName[name])\n        .filter(entity => !!entity);\n    },\n    action(entityTypes) {\n      if(Object.keys(serv.entities).length>options[\"max-entities\"]-entityTypes.length)\n        throw new UserError(\"Too many mobs !\");\n      entityTypes.map(entity => {\n        if(entity.type==\"mob\") serv.spawnMob(entity.id, player.world, player.position.scaled(1/32), {\n          velocity: Vec3((Math.random() - 0.5) * 10, Math.random()*10 + 10, (Math.random() - 0.5) * 10)\n        });\n        else if(entity.type==\"object\") serv.spawnObject(entity.id, player.world, player.position.scaled(1/32), {\n          velocity: Vec3((Math.random() - 0.5) * 10, Math.random()*10 + 10, (Math.random() - 0.5) * 10)\n        });\n      })\n        .reduce((prec,entity) => {\n          if(prec!=null)\n            prec.attach(entity);\n          return entity;\n        },null);\n    }\n  });\n\n  player.commands.add({\n    base: 'attach',\n    info: 'attach an entity on an other entity',\n    usage: '/attach <carrier> <attached>',\n    op: true,\n    parse(str)  {\n      const args=str.split(' ');\n      if(args.length!=2)\n        return false;\n\n      let carrier = player.selectorString(args[0]);\n      if(carrier.length==0) throw new UserError(\"one carrier\");\n      let attached = player.selectorString(args[1]);\n      if(attached.length==0) throw new UserError(\"one attached\");\n\n      return {carrier:carrier[0],attached:attached[0]};\n    },\n    action({carrier,attached}) {\n      carrier.attach(attached);\n    }\n  });\n\n\n  player.spawnEntity = entity => {\n    player._client.write(entity.spawnPacketName, entity.getSpawnPacket());\n    if (typeof entity.itemId != 'undefined') {\n      entity.sendMetadata([{\n        \"key\": 10,\n        \"type\": 5,\n        \"value\": {\n          blockId: entity.itemId,\n          itemDamage: entity.itemDamage,\n          itemCount:1\n        }\n      }]);\n    }\n    entity.equipment.forEach((equipment,slot) => {\n        if (equipment != undefined) player._client.write(\"entity_equipment\", {\n          entityId: entity.id,\n          slot: slot,\n          item: Item.toNotch(equipment)\n        });\n      }\n    )\n  };\n};\n\nmodule.exports.entity=function(entity,serv) {\n  entity.initEntity=(type, entityType, world, position)=>{\n    entity.type = type;\n    entity.spawnPacketName = '';\n    entity.entityType = entityType;\n    entity.world = world;\n    entity.position = position;\n    entity.lastPositionPlayersUpdated = entity.position.clone();\n    entity.nearbyEntities = [];\n    entity.viewDistance = 150;\n    entity.score = {};\n\n    entity.bornTime = Date.now();\n    serv.entities[entity.id] = entity;\n\n    if (entity.type == 'player') entity.spawnPacketName = 'named_entity_spawn';\n    else if (entity.type == 'object') entity.spawnPacketName = 'spawn_entity';\n    else if (entity.type == 'mob') entity.spawnPacketName = 'spawn_entity_living';\n  };\n\n  entity.getSpawnPacket = () => {\n    const scaledVelocity = entity.velocity.scaled(8000/32/20).floored(); // from fixed-position/second to unit => 1/8000 blocks per tick\n    if (entity.type == 'player') {\n      return {\n        entityId: entity.id,\n        playerUUID: entity._client.uuid,\n        x: entity.position.x,\n        y: entity.position.y,\n        z: entity.position.z,\n        yaw: entity.yaw,\n        pitch: entity.pitch,\n        currentItem: 0,\n        metadata: entity.metadata\n      }\n    } else if (entity.type == 'object') {\n      return {\n        entityId: entity.id,\n        type: entity.entityType,\n        x: entity.position.x,\n        y: entity.position.y,\n        z: entity.position.z,\n        pitch: entity.pitch,\n        yaw: entity.yaw,\n        objectData: {\n          intField: entity.data,\n          velocityX: scaledVelocity.x,\n          velocityY: scaledVelocity.y,\n          velocityZ: scaledVelocity.z\n        }\n      }\n    } else if (entity.type == 'mob') {\n      return {\n        entityId: entity.id,\n        type: entity.entityType,\n        x: entity.position.x,\n        y: entity.position.y,\n        z: entity.position.z,\n        yaw: entity.yaw,\n        pitch: entity.pitch,\n        headPitch: entity.headPitch,\n        velocityX: scaledVelocity.x,\n        velocityY: scaledVelocity.y,\n        velocityZ: scaledVelocity.z,\n        metadata: entity.metadata\n      }\n    }\n  };\n\n\n\n  entity.updateAndSpawn = () => {\n    const updatedEntities=entity.getNearby();\n    const entitiesToAdd=updatedEntities.filter(e => entity.nearbyEntities.indexOf(e)==-1);\n    const entitiesToRemove=entity.nearbyEntities.filter(e => updatedEntities.indexOf(e)==-1);\n    if (entity.type == 'player') {\n      entity.despawnEntities(entitiesToRemove);\n      entitiesToAdd.forEach(entity.spawnEntity);\n    }\n    entity.lastPositionPlayersUpdated=entity.position.clone();\n\n    const playersToAdd = entitiesToAdd.filter(e => e.type == 'player');\n    const playersToRemove = entitiesToRemove.filter(e => e.type == 'player');\n\n    playersToRemove.forEach(p => p.despawnEntities([entity]));\n    playersToRemove.forEach(p => p.nearbyEntities=p.getNearby());\n    playersToAdd.forEach(p => p.spawnEntity(entity));\n    playersToAdd.forEach(p => p.nearbyEntities=p.getNearby());\n\n    entity.nearbyEntities=updatedEntities;\n  };\n\n\n  entity.on(\"move\",() => {\n    if(entity.position.distanceTo(entity.lastPositionPlayersUpdated)>2*32)\n      entity.updateAndSpawn();\n  });\n\n  entity.destroy = () => {\n    serv.destroyEntity(entity);\n  };\n\n  entity.attach= (attachedEntity,leash=false) =>\n  {\n    const p={\n      entityId:attachedEntity.id,\n      vehicleId:entity.id,\n      leash:leash\n    };\n    if(entity.type=='player')\n      entity._client.write('attach_entity',p);\n    entity._writeOthersNearby('attach_entity',p);\n  }\n\n};"]}