{"version":3,"sources":["lib/plugins/communication.js"],"names":["module","exports","server","serv","_writeAll","packetName","packetFields","players","forEach","player","_client","write","_writeArray","_writeNearby","loc","getNearby","world","position","radius","filter","distanceTo","getNearbyEntities","entities","map","eId","entity","viewDistance","e","getOtherPlayers","p","getOthers","getNearbyPlayers","type","nearbyPlayers","nearbyEntities","_writeOthers","_writeOthersNearby","concat"],"mappings":"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","file":"../../../lib/plugins/communication.js","sourcesContent":["module.exports.server=function(serv)\n{\n  serv._writeAll= (packetName, packetFields) =>\n    serv.players.forEach((player) => player._client.write(packetName, packetFields));\n\n  serv._writeArray= (packetName, packetFields, players) =>\n    players.forEach((player) =>player._client.write(packetName, packetFields));\n\n  serv._writeNearby= (packetName, packetFields, loc) =>\n    serv._writeArray(packetName, packetFields, serv.getNearby(loc));\n\n  serv.getNearby= ({world,position,radius=8*16*32}) => serv.players.filter( player =>\n    player.world == world &&\n    player.position.distanceTo(position) <= radius\n  );\n\n  serv.getNearbyEntities= ({world,position,radius=8*16*32}) => Object.keys(serv.entities)\n    .map(eId => serv.entities[eId])\n    .filter(entity =>\n      entity.world == world &&\n      entity.position.distanceTo(position) <= radius\n    );\n};\n\nmodule.exports.entity=function(entity,serv)\n{\n  \n  entity.getNearby = () => serv\n    .getNearbyEntities({\n      world: entity.world,\n      position: entity.position,\n      radius: entity.viewDistance*32\n    })\n    .filter((e) => e != entity);\n\n  entity.getOtherPlayers = () => serv.players.filter((p) => p != entity);\n\n  entity.getOthers = () => serv.entities.filter((e) => e != entity);\n\n  entity.getNearbyPlayers = (radius=entity.viewDistance*32) => entity.getNearby()\n    .filter((e) => e.type == 'player');\n\n  entity.nearbyPlayers = (radius=entity.viewDistance*32) => entity.nearbyEntities\n    .filter(e => e.type == 'player');\n\n  entity._writeOthers = (packetName, packetFields) =>\n    serv._writeArray(packetName, packetFields, entity.getOtherPlayers());\n\n  entity._writeOthersNearby = (packetName, packetFields) =>\n    serv._writeArray(packetName, packetFields, entity.getNearbyPlayers());\n\n  entity._writeNearby = (packetName, packetFields) =>\n    serv._writeArray(packetName, packetFields, entity.getNearbyPlayers().concat(entity.type == 'player' ? [entity] : []));\n};"]}