{"version":3,"sources":["lib/plugins/chat.js"],"names":["module","exports","server","serv","broadcast","message","whitelist","players","blacklist","system","type","parseClassic","filter","indexOf","w","forEach","player","chat","color","messageList","text","nextChanged","bold","italic","underlined","strikethrough","random","colors","convertColor","createJSON","trim","push","obfuscated","currChar","newColor","slice","length","extra","_client","on","behavior","command","handleCommand","prefix","username","obj","write","position","emptyChat","count","i"],"mappings":"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","file":"../../../lib/plugins/chat.js","sourcesContent":["module.exports.server=function(serv)\n{\n  serv.broadcast = (message, {whitelist=serv.players,blacklist=[],system=false}={}) => {\n    if (whitelist.type == 'player') whitelist = [whitelist];\n\n    if (typeof message == 'string') message = serv.parseClassic(message);\n\n    whitelist.filter(w => blacklist.indexOf(w) == -1).forEach(player => {\n      if (!system) player.chat(message);\n      else player.system(message);\n    });\n  };\n\n  serv.color = {\n    'black': '&0',\n    'dark_blue': '&1',\n    'dark_green': '&2',\n    'dark_cyan': '&3',\n    'dark_red': '&4',\n    'purple': '&5',\n    'dark_purple': '&5',\n    'gold': '&6',\n    'gray': '&7',\n    'grey': '&7',\n    'dark_gray': '&8',\n    'dark_grey': '&8',\n    'blue': '&9',\n    'green': '&a',\n    'aqua': '&b',\n    'cyan': '&b',\n    'red': '&c',\n    'pink': '&d',\n    'light_purple': '&d',\n    'yellow': '&e',\n    'white': '&f',\n    'random': '&k',\n    'obfuscated': '&k',\n    'bold': '&l',\n    'strikethrough': '&m',\n    'underlined': '&n',\n    'underline': '&n',\n    'italic': '&o',\n    'italics': '&o',\n    'reset': '&r'\n  };\n\n  serv.parseClassic = (message) => {\n    if (typeof message == 'object') return message;\n    const messageList = [];\n    let text = '';\n    let nextChanged = false;\n    let color = 'white';\n    let bold = false;\n    let italic = false;\n    let underlined = false;\n    let strikethrough = false;\n    let random = false;\n    const colors = ['0','1','2','3','4','5','6','7','8','9','a','b','c','d','e','f', 'k','l','m','n','o','r','&'];\n    const convertColor = ['black', 'dark_blue','dark_green','dark_cyan','dark_red','dark_purple','gold',\n                        'gray', 'dark_gray', 'blue', 'green', 'aqua', 'red', 'light_purple', 'yellow', 'white',\n                        'random', 'bold', 'strikethrough', 'underlined', 'italic', 'reset', '&'];\n\n    function createJSON() {\n      if (!text.trim()) return;\n      messageList.push({\n        text: text,\n        color: color,\n        bold: bold,\n        italic: italic,\n        underlined: underlined,\n        strikethrough: strikethrough,\n        obfuscated: random\n      });\n      text = '';\n    }\n\n    while (message != '') {\n      const currChar = message[0];\n      if (nextChanged) {\n        const newColor = convertColor[colors.indexOf(currChar)];\n        if (newColor) {\n          if (newColor == 'bold') bold = true;\n          else if (newColor == 'strikethrough') strikethrough = true;\n          else if (newColor == 'underlined') underlined = true;\n          else if (newColor == 'italic') italic = true;\n          else if (newColor == 'random') random = true;\n          else if (newColor == '&') text += '&';\n          else if (newColor == 'reset') {\n            strikethrough = false;\n            bold = false;\n            underlined = false;\n            random = false;\n            italic = false;\n            color = 'white';\n          } else color = newColor;\n        }\n        nextChanged = false;\n      } else if (currChar == '&') {\n        if (nextChanged) {\n          text += '&';\n          nextChanged = false;\n        } else {\n          nextChanged = true;\n          createJSON();\n        }\n      } else {\n        text += currChar;\n      }\n\n      message = message.slice(1, message.length);\n    }\n    createJSON();\n\n    if (messageList.length > 0) return {\n      text: '',\n      extra: messageList\n    };\n    else return { text: '' }\n  }\n};\n\nmodule.exports.player=function(player,serv)\n{\n  player._client.on('chat', ({message} = {}) => {\n    if(message[0]==\"/\") {\n      player.behavior('command', {command: message.slice(1)}, ({command}) => player.handleCommand(command));\n    }\n    else {\n      player.behavior('chat', {\n        message: message,\n        prefix: '<' + player.username + '> ',\n        text: message,\n        whitelist: serv.players,\n        blacklist: []\n      }, ({prefix, text, whitelist, blacklist}) => {\n        const obj = serv.parseClassic(prefix);\n        if (!obj.extra) obj.extra = [];\n        obj.extra.push(serv.parseClassic(text));\n        serv.broadcast(obj, {\n          whitelist: whitelist,\n          blacklist: blacklist\n        });\n      });\n    }\n  });\n\n  player.chat = message => {\n    if (typeof message == 'string') message = serv.parseClassic(message);\n    player._client.write('chat', { message: JSON.stringify(message), position: 0 });\n  };\n\n  player.emptyChat = (count=1) => {\n    for (let i = 0; i < count; i++) {\n      player.chat('');\n    }\n  };\n\n  player.system = message => {\n    if (typeof message == 'string') message = serv.parseClassic(message);\n    player._client.write('chat', { message: JSON.stringify(message), position: 2 });\n  };\n};"]}