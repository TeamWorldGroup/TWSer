{"version":3,"sources":["lib/plugins/log.js"],"names":["fs","require","timeStarted","Math","floor","Date","toString","path","mkdirp","moment","module","exports","server","serv","settings","on","log","error","stack","client","socket","remoteAddress","remotePort","port","banner","bannedUsername","reason","username","seed","logFile","join","message","format","noConsoleOutput","console","logging","appendFile","err","createLog","writeFile","player","_client","kicker"],"mappings":"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","file":"../../../lib/plugins/log.js","sourcesContent":["const fs = require('fs');\nconst timeStarted = Math.floor(new Date() / 1000).toString();\nconst path = require('path');\nconst mkdirp = require('mkdirp');\nconst moment=require(\"moment\");\n\nmodule.exports.server=function(serv,settings)\n{\n  serv.on(\"error\", error => serv.log('[ERR]: Server: '+error.stack));\n  serv.on(\"clientError\", (client,error) => serv.log('[ERR]: Client '+client.socket.remoteAddress + ':' + client.socket.remotePort+' : '+error.stack));\n\n  serv.on(\"listening\", port => serv.log('[INFO]: Server listening on port '+port));\n\n  serv.on(\"banned\", (banner,bannedUsername,reason) =>\n    serv.log(banner.username + \" banned \" + bannedUsername + (reason ? \" (\" + reason + \")\" : \"\")));\n\n  serv.on(\"seed\", (seed) => serv.log(\"seed: \"+seed));\n\n  const logFile=path.join(\"logs\",timeStarted + \".log\");\n\n  serv.log = message => {\n    message=moment().format('MMMM Do YYYY, HH:mm:ss')+\" \"+message;\n    if(!settings.noConsoleOutput) console.log(message);\n    if (!settings.logging) return;\n    fs.appendFile(logFile, message + \"\\n\", (err) => {\n      if (err) console.log(err);\n    });\n  };\n\n  serv.createLog = () => {\n    if (!settings.logging) return;\n    mkdirp(\"logs\", (err) => {\n      if(err)\n      {\n        console.log(err);\n        return;\n      }\n\n      fs.writeFile(logFile, \"[INFO]: Started logging...\\n\",\n        (err) => {\n          if (err) console.log(err);\n        });\n    });\n  };\n};\n\nmodule.exports.player=function(player,serv)\n{\n\n  player.on(\"connected\",() => serv.log(\"[INFO]: \" + player.username + ' (' + player._client.socket.remoteAddress + ') connected'));\n\n  player.on(\"spawned\",() => serv.log(\"[INFO]: position written, player spawning...\"));\n\n  player.on(\"disconnected\",() => serv.log(\"[INFO]: \" + player.username + ' disconnected'));\n\n  player.on(\"chat\", ({message}) => serv.log(\"[INFO] \" + '<' + player.username + '>' + ' ' + message));\n\n  player.on(\"kicked\",(kicker,reason) =>\n    serv.log(kicker.username + \" kicked \" + player.username + (reason ? \" (\" + reason + \")\" : \"\")));\n\n};"]}