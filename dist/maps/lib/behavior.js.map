{"version":3,"sources":["lib/behavior.js"],"names":["module","exports","obj","eventName","data","func","cancelFunc","hiddenCancelled","cancelled","cancelCount","defaultCancel","cancel","dC","hidden","resp","emitThen","catch","err","setTimeout"],"mappings":";;;;;;;;;;;;;;;;AAAAA,OAAOC,OAAP,GAAiB,UAACC,GAAD,EAAS;AACxB;AAAA,wFAAO,iBAAOC,SAAP,EAAkBC,IAAlB,EAAwBC,IAAxB,EAA8BC,UAA9B;AAAA;AAAA;AAAA;AAAA;AAAA;AACDC,6BADC,GACiB,KADjB;AAEDC,uBAFC,GAEW,KAFX;AAGDC,yBAHC,GAGa,CAHb;AAIDC,2BAJC,GAIe,IAJf;;AAKCC,oBALD,GAKU,SAATA,MAAS,GAA2B;AAAA,oBAA1BC,EAA0B,uEAAvB,IAAuB;AAAA,oBAAjBC,MAAiB,uEAAV,KAAU;AAAE;AAC1C,oBAAIA,MAAJ,EAAYN,kBAAkB,IAAlB,CAAZ,KACK;AACHC,8BAAY,IAAZ;AACAC;AACD;AACDC,gCAAgBE,EAAhB;AACD,eAZI;;AAcDE,kBAdC;AAAA;AAAA,qBAgBCZ,IAAIa,QAAJ,CAAaZ,YAAY,SAAzB,EAAoCC,IAApC,EAA0CO,MAA1C,EAAkDK,KAAlD,CAAwD,UAACC,GAAD;AAAA,uBAAQC,WAAW,YAAM;AAAC,wBAAMD,GAAN;AAAW,iBAA7B,EAA8B,CAA9B,CAAR;AAAA,eAAxD,CAhBD;;AAAA;AAAA;AAAA,qBAiBCf,IAAIa,QAAJ,CAAaZ,SAAb,EAAwBC,IAAxB,EAA8BI,SAA9B,EAAyCC,WAAzC,EAAsDO,KAAtD,CAA4D,UAACC,GAAD;AAAA,uBAAQC,WAAW,YAAM;AAAC,wBAAMD,GAAN;AAAW,iBAA7B,EAA8B,CAA9B,CAAR;AAAA,eAA5D,CAjBD;;AAAA;AAAA,oBAmBD,CAACV,eAAD,IAAoB,CAACC,SAnBpB;AAAA;AAAA;AAAA;;AAoBHM,qBAAOT,KAAKD,IAAL,CAAP;;AApBG,oBAqBCU,iCArBD;AAAA;AAAA;AAAA;;AAAA;AAAA,qBAqBuCA,KAAKE,KAAL,CAAW,UAACC,GAAD;AAAA,uBAAQC,WAAW,YAAM;AAAC,wBAAMD,GAAN;AAAW,iBAA7B,EAA8B,CAA9B,CAAR;AAAA,eAAX,CArBvC;;AAAA;AAqB0BH,kBArB1B;;AAAA;AAsBH,kBAAI,OAAOA,IAAP,IAAe,WAAnB,EAAgCA,OAAO,IAAP;AAtB7B;AAAA;;AAAA;AAAA,oBAuBMR,cAAcI,aAvBpB;AAAA;AAAA;AAAA;;AAwBHI,qBAAOR,WAAWF,IAAX,CAAP;;AAxBG,oBAyBCU,iCAzBD;AAAA;AAAA;AAAA;;AAAA;AAAA,qBAyBuCA,KAAKE,KAAL,CAAW,UAACC,GAAD;AAAA,uBAAQC,WAAW,YAAM;AAAC,wBAAMD,GAAN;AAAW,iBAA7B,EAA8B,CAA9B,CAAR;AAAA,eAAX,CAzBvC;;AAAA;AAyB0BH,kBAzB1B;;AAAA;AA0BH,kBAAI,OAAOA,IAAP,IAAe,WAAnB,EAAgCA,OAAO,KAAP;;AA1B7B;AAAA;AAAA,qBA4BCZ,IAAIa,QAAJ,CAAaZ,YAAY,OAAzB,EAAkCC,IAAlC,EAAwCI,SAAxC,EAAmDQ,KAAnD,CAAyD,UAACC,GAAD;AAAA,uBAAQC,WAAW,YAAM;AAAC,wBAAMD,GAAN;AAAW,iBAA7B,EAA8B,CAA9B,CAAR;AAAA,eAAzD,CA5BD;;AAAA;AAAA,+CA8BEH,IA9BF;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAP;;AAAA;AAAA;AAAA;AAAA;AAgCD,CAjCD","file":"../../lib/behavior.js","sourcesContent":["module.exports = (obj) => {\n  return async (eventName, data, func, cancelFunc) => {\n    let hiddenCancelled = false;\n    let cancelled = false;\n    let cancelCount = 0;\n    let defaultCancel = true;\n    const cancel = (dC=true, hidden=false) => { // Hidden shouldn't be used often but it's not hard to implement so meh\n      if (hidden) hiddenCancelled = true;\n      else {\n        cancelled = true;\n        cancelCount++;\n      }\n      defaultCancel = dC;\n    };\n    \n    let resp;\n\n    await obj.emitThen(eventName + '_cancel', data, cancel).catch((err)=> setTimeout(() => {throw err;},0));\n    await obj.emitThen(eventName, data, cancelled, cancelCount).catch((err)=> setTimeout(() => {throw err;},0));\n\n    if (!hiddenCancelled && !cancelled) {\n      resp = func(data);\n      if (resp instanceof Promise) resp = await resp.catch((err)=> setTimeout(() => {throw err;},0));\n      if (typeof resp == 'undefined') resp = true;\n    } else if (cancelFunc && defaultCancel) {\n      resp = cancelFunc(data);\n      if (resp instanceof Promise) resp = await resp.catch((err)=> setTimeout(() => {throw err;},0));\n      if (typeof resp == 'undefined') resp = false;\n    }\n    await obj.emitThen(eventName + '_done', data, cancelled).catch((err)=> setTimeout(() => {throw err;},0));\n\n    return resp;\n  }\n};"]}